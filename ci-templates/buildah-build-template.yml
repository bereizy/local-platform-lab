.build_image_template:
  image: quay.io/buildah/stable
  variables:
    STORAGE_DRIVER: vfs
    BUILDAH_FORMAT: docker
    TLS_VERIFY: "true"  # Set to "false" for local/insecure registries
  script:
    - echo "Logging into registry..."
    - buildah login --tls-verify=$TLS_VERIFY -u "$CI_REGISTRY_USER" -p "$CI_REGISTRY_PASSWORD" "$CI_REGISTRY"
    - echo "Building image $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA"
    - buildah bud --tls-verify=$TLS_VERIFY -t "$CI_REGISTRY_IMAGE:$CI_COMMIT_SHA" .
    - echo "Pushing image..."
    - buildah push --tls-verify=$TLS_VERIFY "$CI_REGISTRY_IMAGE:$CI_COMMIT_SHA"
    - echo "Build and push complete."
