.deploy_template:
  image: bitnami/kubectl:latest
  script:
    - echo "Deploying to Kubernetes..."
    - kubectl config set-cluster default --server=https://kubernetes.default.svc --insecure-skip-tls-verify=true
    - kubectl config set-credentials default --token=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)
    - kubectl config set-context default --cluster=default --user=default
    - kubectl config use-context default
    - sed -i "s|IMAGE_PLACEHOLDER|$CI_REGISTRY_IMAGE:$CI_COMMIT_SHA|g" deployment.yaml
    - kubectl apply -f deployment.yaml
    - echo "Deployment applied."
